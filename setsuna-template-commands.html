<div class="PostContainer"><div class="Main">
<div class="CharacterName">Setsuan Tasumaki</div>
<div class="body" style="min-height: 150px;">
<div class="Content"><div class="health"><p>HP: </p>
<div class="hp-bar"><div class="hp-bar-fill"></div></div></div>
  
<div class="points"><p>IP</p><div class="ip-bar"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div><p>MP</p><div class="mp-bar"><div></div><div></div><div></div><div></div><div></div><div></div></div></div>

<div class="stats"><p>STR: d6</img></p><p>MAG: d6</p><p>DEF: d6</p><p>AGL: d6</p></div>

<div class="stats">
<p style="flex:2;">Command Style</p>
<div class="sty">Style Name Here
<div class="popout"> You can add as many or as few details as you'd like here. 

<hr>You can start a line with [hr] to break up lines with a... line, if you want to keep things neat and orderly. 
</div></div>
</div>

<div class="side-by-side">
<div class="container">
  
<details><summary>Command Deck</summary>  
<div class="command-deck">
  
<div class="cmd aetherstep">Aetherstep
<div class="popout"> 
  <b>HR</b> Dodge. Grants Haste.</br>
  Can spend MP to boost HR (Max +6)
  <hr><b>AGL - CP 4</b></br>
  <i>Empowering, Essential, Stylish</i>
      </div></div>

<div class="cmd barrier">Barrier
<div class="popout"> 
  Mine and Protect for 3 turns</br>
  Restores HR HP after cooldown
  <hr><b>DEF - CP 4</b></br>
  <i>Empower II, Linger, Stylish</i>
      </div></div>

<div class="cmd barrage"> Barrage
<div class="popout"> 
<b>HR+X</b> Damage. X = Negative conditions on target (Max 4)</br>
<b>LR:</b> Panic and Slow</br>
<hr><b>MAG - CP 4</b></br>
<i>Damage, Hinder II, Stylish</i>
  </div></div>

<div class="cmd bombardment">Bombardment
<div class="popout">
<b>HR</b> Damage to all enemies. Can spend MP to boost HR (Max +6)</br>
<b>LR:</b> Sunder</br>
<hr><b>MAG - CP 4</b></br>
<i>Damage, Hinder, Overcharge, Stylish</i></div></div>

<div class="cmd mastered grandlarceny">
✦ Grand Larceny
<div class="popout"> 
Dualcast, Quick, +2 MP gains for 3 turns
<hr>[i]VERSATILE[/i] - [b]HR[/b] Healing
<br>Can spend MP to boost HR (Max +6)
<br>Grants Regen & Heals 2 HP when gaining MP for 3 turns
<hr><i>Signature Command</i></div></div>

<div class="cmd penance">Penance
<div class="popout"> 
<b>HR:</b> Light-element Strike</br>
<b>LR:</b> Heals Self & Inflicts Silence 
<hr><b>MAG - CP 4</b></br>
<i>Essential, Heal, Hinder</i></div></div>
  
<div class="cmd reap">Reap
<div class="popout"> 
<b>HR:</b> Dark-element Damage</br>
<b>LR:</b> Inflict Zombie, Heals self</br>
<hr><b>MAG - CP 4</b></br>
<i>Essential, Heal, Hinder</i>
</div></div>

<div class="cmd reave">Reave
<div class="popout"> 
<b>HR</b> Damage to all enemies. Can spend MP to boost HR (Max +6)
<hr>Opposing Dodges receive -2 penalty
<hr><b>MAG - CP 4</b></hr>
<i>Empowering, Hinder, Overcharge, Stylish</i></div></div>

<div class="cmd reflect">Reflect
<div class="popout"> 
<b>HR</b> Guard. </br>
<b>LR</b> Weaken.
<br>Grants Recoil.
<hr><b>DEF - CP 4</b></br>
<i>Empowering, Essential, Hinder</i></div></div>

<div class="cmd spellstrike">Spellstrike
<div class="popout"> 
<b>HR</b> Damage. </br>
<b>LR</b> Dispel.
<br>Grants Dualcast for 3 turns
<hr><b>MAG - CP 4</b></br>
<i>Damage, Empower, Hinder, Linger</i>
</div></div>
  
<div class="cmd spellpurge">Spellpurge
 <div class="popout"> 
<b>HR</b> Cleanse.
<hr>Immunizes target to condition if Setsuna has a command that lists it in cooldown for 3 turns.
<hr><b>MAG - CP 4</b></br>
<i>Essential, Linger, Stylish</i>
</div></div>

<div class="cmd spellsurge">Spellsurge
<div class="popout"> 
<b>HR</b> Charge. Grants Shell.
<br> Recovers 2 MP when a command cools down
<hr><b>MAG - CP 4</b></br>
<i>Empower, Essential, Stylish</i>
</div></div>

<div class="cmd salvo">Salvo
<div class="popout"> <b>HR:</b> Light-element Damage. Deals +1 damage for each command in cooldown (Max +4)</br>
<b>LR:</b> Sunder for 3 turns
<hr><b>MAG - CP 4</b></br>
<i>Damage, hinder, Linger, Stylish</i>
</div></div>


<div class="cmd mastered titanomachia">✦ Titanomachia
<div class="popout">Water-element Mine. Deals 2 Thunder Damage to all enemies when gaining MP for 3 turns. Grants <b>Crashing Wave</b> and <b>Riptide</b> commands. <hr>
<b>Versatile</b> - <b>HR+2</b> Water-element damage to all enemies. +2 damage each time this command cools down. Grants <b>Devestation</b> and <b>Ruination</b> commands. 
<hr><b>STR - CP 6</b></br>
<i>Command II, Empower, Linger, Stylish, Versatile (Command 2, Damage, Overcharge, Stylish)</i>
</div></div>


<div class="cmd commanding crashingwave">Crashing Wave
<div class="popout"> <b>HR:</b> Water-element Damage.<hr>
When using a Water attack, Setsuna gains 2 MP and deals 3 Thunder damage to a target affect by his Hindering condition for 3 turns
<hr><b>STR - CP 4</b></br>
<i>Damage, Empower, Linger, Stylish</i>
</div></div>


<div class="cmd commanding salvo">Riptide
<div class="popout"> <b>HR:</b> Water-element DoT. </br>
  <b>LR:</b> Slow</br>
<hr>Grants Combo+. Adds +2 damage to Water attacks. Applies Water-element to Strike and Raid.
<hr><b>MAG - CP 4</b></br>
<i>Empower, Hinder 2, Stylish</i>
</div></div>


<div class="cmd commanding devastation">Devastation
<div class="popout"> <b>HR+2+X</b> Water-element Damage to all enemies. X equals amount of MP gained this turn.</br>
<hr><b>MAG - CP 4</b></br>
<i>Damage II, Overcharge, Stylish</i>
</div></div>


<div class="cmd commanding ruination">Ruination
<div class="popout"> <b>HR+2+X</b> Water-element Damage. X equals amount of MP spent (Max 6).</br>
<hr>Dodge attempts recieve a -2 penalty
<hr><b>MAG - CP 4</b></br>
<i>Damage II - Hinder - Stylish</i>
</div></div>

<div class="cmd mastered witchinghour">✦ The Witching Hour
<div class="popout">
<b>HR</b> Damage to all enemies</br>
<br>Can spend MP to boost HR (Max +6)
<b>LR:</b> Sunder</br>
<hr><i>Damage, Hinder, Overcharge, Stylish</i>
</div></div>

<div class="cmd commanding blight">Blight
<div class="popout"> 
<b>HR</b> Dispel and <b>LR</b> Stun to all enemies for 3 turns
<hr><b>MAG - CP 4</b></br>
<i>Hinder II - Linger - Overcharge</i>
</div></div>

<div class="cmd commanding warp">Warp
<div class="popout"> 
<b>HR</b> Slow and <b>LR</b> Sunder to all enemies for 3 turns
<hr><b>MAG - CP 4</b></br>
<i>Hinder II - Linger - Overcharge</i></div></div>
                   
</div></details></div>





<div class="container container2">
<details><summary>Provisions</summary>  
<div class="provisions-list">
  
<div class="prv">Potion
<div class="popout"> 
<b>HR</b> Effects</br>
<b>LR</b> Effects</br>
Other effects here
<hr><i>Properties & Stat here</i>
</div></div>

<div class="prv">Just Getting Started
<div class="popout"> 
<b>HR</b> Effects</br>
<b>LR</b> Effects</br>
Other effects here
<hr><i>Properties & Stat here</i>
</div></div>
</details></div></div>
</div>  

</div></div>


  <script>
  document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM fully loaded and parsed');
    function loadExternalHTML(url, placeholderId) {
      console.log('Fetching external HTML from', url);
      fetch(url)
        .then(response => {
          console.log('Response status:', response.status);
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          return response.text();
        })
        .then(data => {
          console.log('Data received:', data);
          const parser = new DOMParser();
          const doc = parser.parseFromString(data, 'text/html');
          const content = doc.body;
          console.log('Parsed content:', content);
          document.getElementById(placeholderId).appendChild(content);

          console.log('External HTML loaded and appended.');

          // Reapply behaviors and styles
          applyBehaviorsAndStyles();
        })
        .catch(error => {
          console.error('Error loading external HTML:', error.message);
          console.error(error);
        });
    }

    // Initial call to load external HTML
    loadExternalHTML('https://theonethane.github.io/theonethane/setsuna-template-commands.html', 'external-html-placeholder');

    // Initial application of behaviors and styles
    applyBehaviorsAndStyles();
  });

  function applyBehaviorsAndStyles() {
    console.log('Applying behaviors and styles.');
    var elements = document.querySelectorAll('.cmd, .prv, .sty');
    console.log('Elements found:', elements);
    attachToggleBehavior(elements);
    applyStyles();
  }

  function attachToggleBehavior(elements) {
    console.log('Attaching toggle behavior.');
    elements.forEach(function(element) {
      element.setAttribute('tabindex', '0');
      element.addEventListener('click', function() {
        togglePopout(element);
      });
    });
  }

  function togglePopout(element) {
    console.log('Toggling popout for element:', element);
    // Close all other popouts and remove the clicked class from cmd and prv
    var allElements = document.querySelectorAll('.cmd, .prv, .sty');
    allElements.forEach(function(el) {
      if (el !== element) {
        el.classList.remove('show');
        if (el.classList.contains('cmd') || el.classList.contains('prv')) {
          el.classList.remove('clicked');
        }
      }
    });

    // Toggle the show class on the clicked element
    element.classList.toggle('show');
    // Toggle the clicked class only for cmd and prv
    if (element.classList.contains('cmd') || element.classList.contains('prv')) {
      element.classList.toggle('clicked');
    }
  }

  function applyStyles() {
    console.log('Applying styles.');
    const elements = document.querySelectorAll('.cmd');
    console.log('cmd elements:', elements);

    elements.forEach(element => {
      const classList = element.className.split(' ');
      const mainClass = classList.find(cls => cls !== 'cmd' && cls !== 'mastered' && cls !== 'commanding');
      const shorthandVariable = '--' + mainClass;
      
      const shorthandValue = getComputedStyle(element).getPropertyValue(shorthandVariable).trim();
      const [activeValue, displayValue] = shorthandValue.split(',').map(val => val.trim());

      console.log(`Element: ${element.className}, Active: ${activeValue}, Display: ${displayValue}`);
      
      // Calculate the opacity based on the active value
      const opacity = parseFloat(activeValue) + 0.5;
      
      // Apply background color based on class
      if (classList.includes('mastered')) {
        element.style.background = `rgba(var(--mastered-color), ${opacity})`;
      } else if (classList.includes('commanding')) {
        element.style.background = `rgba(var(--cmd-color), ${opacity})`;
        element.style.borderColor = `rgba(var(--mastered-color), ${opacity})`;
      } else {
        element.style.background = `rgba(var(--cmd-color), ${opacity})`;
      }

      // Convert "hide" to "none" for display property
      const display = displayValue === 'hide' ? 'none' : 'block';

      // Handle display property based on custom variables
      element.style.display = display;
      const popout = element.querySelector('.popout');
      if (popout) {
        popout.style.display = display;
      }
    });
  }
</script>
